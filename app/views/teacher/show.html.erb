<% flash.each do |name, msg| %>
  <%= content_tag :div, msg, class: "alert alert-info" %>
<% end %>

<%= link_to "Change your password", edit_user_registration_path %>
<br>
<%= form_tag "/teacher/#{current_user.id}", method: "patch" do %>
  <%= label :pathway, "Teacher's Pathway:" %>
  <%= select_tag :pathway, options_for_select(@pathways, current_user.pathway)%>
  <%= submit_tag "Change teacher's default pathway" %>
<% end %>
<%= form_tag teacher_path(current_user), method: "get" do %>
  <%= label :student_id, "Student Lookup:"  %>
    <%= text_field_tag :student_id, nil, placeholder: "student id#"%>
    <%= submit_tag "Find Student", class: "btn btn-warning"%>
<% end %>
<br>
<div class="student-lookup-return">
  <% if @student %>
    <table class="table build-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Grade</th>
          <th>Pathway</th>
          <th>School</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><%= @student.name %></td>
          <td><%= @student.email %></td>
          <td><%= @student.grade %></td>
          <td><%= @student.pathway %></td>
          <td><%= @student.school %></td>
        </tr>
      </tbody>
    </table>
  <% end %>
</div>

<div class="menu-wrapper">
  <div class="pull-left col-4">
    <%= link_to "Create an event", new_event_path, class: "btn btn-primary" %>
    <%= link_to "Add a provider", new_provider_path, class: "btn btn-success text-center" %>
  </div>
  <br>
</div>
<% if @upcoming_events.length > 0 %>
<br>
  <h3>Upcoming Events</h3>
  <table class="table table-striped text-center pre-scrollable">
    <th>
      <td><strong>Pathway</strong></td>
      <td><strong>Activity</strong></td>
      <td><strong>Provider</strong></td>
      <td><strong>Location</strong></td>
      <td><strong>Date</strong></td>
    </th>
    <% @upcoming_events.each do |event| %>
      <% provider = Provider.find(event.provider_id) %>
      <tr>
        <td>
          <%= link_to "edit this event", edit_event_path(event.id), class: "teacher-edit-button btn-xs btn-info text-center" %>
        </td>
        <td><%= event.pathway %></td>
        <td><%= event.activity %></td>
        <td><%= link_to_if(provider.url != "N/A", provider.name, provider.url, target: :_blank) %></td>
        <td> <%= event.location %></td>
        <td><%= event.date.strftime("%A, %B %d") %></td>
      </tr>
    <% end %>
  </table>
<% end %>
<% if @past_events.length > 0 %>
  <h3>Past Events</h3>
  <table class="table table-striped text-center pre-scrollable">
    <th>
      <td></td>
      <td><strong>Pathway</strong></td>
      <td><strong>Activity</strong></td>
      <td><strong>Provider</strong></td>
      <td><strong>Location</strong></td>
      <td><strong>Date</strong></td>
    </th>
    <% @past_events.each do |event| %>
      <% provider = Provider.find(event.provider_id)  %>
      <% survey = Survey.where(user_id: current_user.id, event_id: event.id).first %>
      <tr>
        <td>
          <% if survey.complete %>
            <%= link_to "review this<br/>survey".html_safe, edit_survey_path(survey.id), class: "survey-button btn-xs btn-info text-center" %>
          <% else %>
            <%= link_to "take this<br/>survey".html_safe, edit_survey_path(survey.id), class: "survey-button btn-xs btn-danger text-center" %>
          <% end %>
        </td>
        <td>
          <%= link_to "review data", event_survey_index_path(event.id), class: "teacher-survey-button btn-xs btn-warning text-center" %>
        </td>
        <td><%= event.pathway %></td>
        <td><%= event.activity %></td>
        <td><%= link_to_if(provider.url != "N/A", provider.name, provider.url, target: :_blank) %></td>
        <td> <%= event.location %></td>
        <td><%= event.date.strftime("%A, %B %d") %></td>
      </tr>
    <% end %>
  </table>
<% end %>


